diff -Naurp squashfs.orig/linux-2.6/inode.c squashfs/linux-2.6/inode.c
--- squashfs.orig/linux-2.6/inode.c	2008-03-21 19:49:30.000000000 +0000
+++ squashfs/linux-2.6/inode.c	2008-03-21 19:50:35.000000000 +0000
@@ -31,7 +31,11 @@
 #include <linux/vfs.h>
 #include <linux/vmalloc.h>
 #include <linux/smp_lock.h>
+#include <linux/version.h>
+
+#if (LINUX_VERSION_CODE >= KERNEL_VERSION(2,6,23))
 #include <linux/exportfs.h>
+#endif
 
 #include "squashfs.h"
 
@@ -2159,8 +2163,11 @@ static void squashfs_destroy_inode(struc
 	kmem_cache_free(squashfs_inode_cachep, SQUASHFS_I(inode));
 }
 
-
+#if (LINUX_VERSION_CODE < KERNEL_VERSION(2,6,24))
+static void init_once(void * foo, struct kmem_cache * cachep, unsigned long flags)
+#else
 static void init_once(struct kmem_cache *cachep, void *foo)
+#endif
 {
 	struct squashfs_inode_info *ei = foo;
 
@@ -2172,7 +2179,11 @@ static int __init init_inodecache(void)
 {
 	squashfs_inode_cachep = kmem_cache_create("squashfs_inode_cache",
 	    sizeof(struct squashfs_inode_info), 0,
+#if (LINUX_VERSION_CODE >= KERNEL_VERSION(2,6,23))
 		SLAB_HWCACHE_ALIGN|SLAB_RECLAIM_ACCOUNT, init_once);
+#else
+		SLAB_HWCACHE_ALIGN|SLAB_RECLAIM_ACCOUNT, init_once, NULL);
+#endif
 	if (squashfs_inode_cachep == NULL)
 		return -ENOMEM;
 	return 0;
