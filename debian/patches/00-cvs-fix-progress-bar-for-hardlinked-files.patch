diff -Naurp squashfs-3.3.orig/squashfs-tools/mksquashfs.c squashfs-3.3/squashfs-tools/mksquashfs.c
--- squashfs-3.3.orig/squashfs-tools/mksquashfs.c	2008-03-29 08:38:57.000000000 +0000
+++ squashfs-3.3/squashfs-tools/mksquashfs.c	2008-03-29 08:39:37.000000000 +0000
@@ -2341,6 +2341,10 @@ struct inode_info *lookup_inode(struct s
 	inode->read = FALSE;
 	inode->inode = SQUASHFS_INVALID_BLK;
 	inode->nlink = 1;
+
+	if((buf->st_mode & S_IFMT) == S_IFREG)
+		estimated_uncompressed += (buf->st_size + block_size - 1) >> block_log;
+
 	if((buf->st_mode & S_IFMT) == S_IFDIR)
 		inode->inode_number = dir_inode_no ++;
 	else
@@ -2614,9 +2618,6 @@ struct dir_info *dir_scan1(char *pathnam
 				continue;
 		}
 
-		if((buf.st_mode & S_IFMT) == S_IFREG)
-			estimated_uncompressed += (buf.st_size + block_size - 1) >> block_log;
-
 		if((buf.st_mode & S_IFMT) == S_IFDIR) {
 			if((sub_dir = dir_scan1(filename, new, scan1_readdir)) == NULL)
 				continue;
